# Domain Models

Domain models are the core entities of your application. They represent business concepts and contain both data and behavior.

## Creating Domain Models

Domain models in Potato extend `Domain`, which is built on Pydantic's `BaseModel`:

```python
from potato import Domain

class User(Domain):
    id: int
    username: str
    email: str
    age: int | None = None
    friends: list[str] = []
```

All standard Python types and Pydantic field types are supported.

## Auto[T] — System-Managed Fields

`Auto[T]` marks fields managed by your system (auto-generated IDs, timestamps, computed values). These fields are **excluded from BuildDTOs** but **included in ViewDTOs**.

```python
from potato import Domain, Auto
from datetime import datetime

class User(Domain):
    id: Auto[int]              # Auto-generated by database
    created_at: Auto[datetime] # Set by database
    username: str              # User-provided
    email: str                 # User-provided
```

At runtime, `Auto[int]` is just `int` — the annotation metadata tells Potato how to treat the field in DTOs.

### UNASSIGNED Sentinel

Auto fields default to `UNASSIGNED` — a sentinel value that raises an error on any access. This prevents accidentally using an Auto field before it has been assigned a real value:

```python
user = User(username="alice", email="alice@example.com")
user.id  # Raises: accessing UNASSIGNED Auto field 'id'
```

Provide the value when creating from a BuildDTO:

```python
user = dto.to_domain(id=1, created_at=datetime.now())
```

## Private[T] — Never-Exposed Fields

`Private[T]` marks fields that should **never be exposed** in any DTO. Attempting to include a `Private` field in a `ViewDTO` raises a `TypeError` at class-definition time.

```python
from potato import Domain, Private

class User(Domain):
    id: int
    username: str
    password_hash: Private[str]  # Never exposed in any DTO
    api_key: Private[str]        # Never exposed in any DTO
```

Use `Private[T]` for sensitive data: password hashes, API keys, internal tokens.

### Auto vs Private

| Marker | BuildDTO | ViewDTO | Use case |
|--------|----------|---------|----------|
| `Auto[T]` | Excluded | Included | IDs, timestamps, computed values |
| `Private[T]` | Excluded | **Forbidden** | Passwords, API keys, secrets |

## Validation

Domain models use Pydantic's validation:

```python
from pydantic import field_validator

class User(Domain):
    id: int
    email: str

    @field_validator('email')
    @classmethod
    def validate_email(cls, v: str) -> str:
        if '@' not in v:
            raise ValueError('email must contain @')
        return v
```

## Field References

Domain fields can be referenced as class attributes for use in ViewDTO field mappings:

```python
from potato import ViewDTO, Field

class UserView(ViewDTO[User]):
    login: str = Field(source=User.username)
```

For nested domains, chain field access:

```python
class Address(Domain):
    city: str
    street: str

class User(Domain):
    name: str
    address: Address

class UserView(ViewDTO[User]):
    name: str
    city: str = Field(source=User.address.city)
```

See [Field Mapping](field-mapping.md) for the full guide.

## Next Steps

- **[ViewDTO](viewdto.md)** — Create output DTOs from domain models
- **[BuildDTO](builddto.md)** — Create domain models from input DTOs
- **[Aggregates](aggregates.md)** — Compose multiple domains
