# System Fields

`System[T]` marks fields that are managed by your system, not by external users. This distinction is crucial for maintaining clear boundaries between user input and system-managed data.

## What are System Fields?

System fields are values that your application generates or manages:

- **Auto-generated IDs**: Database primary keys
- **Timestamps**: `created_at`, `updated_at` set by the database
- **Computed values**: Values calculated by your system
- **Internal state**: Fields managed by business logic

```python
from potato import Domain, System
from datetime import datetime

class User(Domain):
    id: System[int]  # Auto-generated by database
    created_at: System[datetime]  # Set by database
    username: str  # User-provided
    email: str  # User-provided
```

## Why System Fields?

### Clear Separation

System fields separate user input from system concerns:

```python
# Without System fields - unclear boundaries
class User(Domain):
    id: int  # Who sets this? User or system?
    username: str
    email: str

# With System fields - clear boundaries
class User(Domain):
    id: System[int]  # Clearly system-managed
    username: str  # Clearly user-provided
    email: str  # Clearly user-provided
```

### Security

System fields prevent users from setting sensitive values:

```python
# ❌ Without System fields
class UserCreate(BuildDTO[User]):
    id: int  # User could set this!
    username: str

# User could try: UserCreate(id=999, username="hacker")
# Might overwrite another user's data!

# ✅ With System fields
class UserCreate(BuildDTO[User]):
    # id is automatically excluded
    username: str

# User can only set username, not id
```

### Explicit Contracts

System fields make contracts explicit:

```python
class UserCreate(BuildDTO[User]):
    username: str
    email: str
    # id is excluded - you must provide it

user = dto.to_domain(id=generate_id())  # Explicit: you provide id
```

## System Field Behavior

### Excluded from BuildDTO

System fields are automatically excluded from BuildDTOs:

```python
class User(Domain):
    id: System[int]
    username: str
    email: str

class UserCreate(BuildDTO[User]):
    # id is automatically excluded
    username: str
    email: str

dto = UserCreate(username="alice", email="alice@example.com")
# dto has no 'id' field
```

### Required in ViewDTO

System fields are required in ViewDTOs:

```python
class UserView(ViewDTO[User]):
    id: int  # Required - must include System fields
    username: str
    email: str
```

### Provided to `to_domain()`

You supply system fields when creating domains:

```python
dto = UserCreate(username="alice", email="alice@example.com")
user = dto.to_domain(
    id=generate_id(),  # You provide system fields
    created_at=datetime.now()
)
```

## Common System Fields

### Auto-generated IDs

```python
class User(Domain):
    id: System[int]  # Database primary key
    username: str
```

### Timestamps

```python
class Post(Domain):
    id: System[int]
    created_at: System[datetime]  # Set by database
    updated_at: System[datetime]  # Set by database
    title: str
```

### Computed Values

```python
class Order(Domain):
    id: System[int]
    total: System[int]  # Computed from items
    items: list[OrderItem]
```

### Internal State

```python
class User(Domain):
    id: System[int]
    is_active: System[bool]  # Managed by business logic
    username: str
```

## System Fields Best Practices

### 1. Mark All System-Managed Fields

Be explicit about what the system manages:

```python
# ✅ Good: Clear about system fields
class User(Domain):
    id: System[int]
    created_at: System[datetime]
    username: str
    email: str

# ❌ Bad: Unclear boundaries
class User(Domain):
    id: int  # Is this system-managed?
    created_at: datetime  # Is this system-managed?
    username: str
    email: str
```

### 2. Don't Overuse System Fields

Only mark fields that are truly system-managed:

```python
# ✅ Good: Only system fields marked
class User(Domain):
    id: System[int]  # System-managed
    username: str  # User-provided
    email: str  # User-provided

# ❌ Bad: Everything marked as system
class User(Domain):
    id: System[int]
    username: System[str]  # User provides this!
    email: System[str]  # User provides this!
```

### 3. Provide System Fields Explicitly

Always provide system fields when creating domains:

```python
# ✅ Good: Explicit system fields
user = dto.to_domain(
    id=generate_id(),
    created_at=datetime.now()
)

# ❌ Bad: Missing system fields
user = dto.to_domain()  # Missing required system fields!
```

## System Fields vs Regular Fields

| Aspect | System Fields | Regular Fields |
|--------|--------------|----------------|
| **BuildDTO** | Excluded | Included |
| **ViewDTO** | Required | Required |
| **to_domain()** | Provided by caller | From BuildDTO |
| **Purpose** | System-managed | User-provided |

## Next Steps

- Learn about [BuildDTO](../core/builddto.md) - see how system fields are excluded
- Explore [ViewDTO](../core/viewdto.md) - see how system fields are required
- Understand [Domain Models](../core/domain.md) - see system fields in practice

